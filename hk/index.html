<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="https://k.sinaimg.cn/n/sinakd20101/644/w722h722/20231018/010c-7e8d43cb4b970f280203cc75c541b89a.jpg/w700d1q75cms.jpg" />
    <title>æ™ºèƒ½æ’è°·ç®¡ç†ç³»ç»Ÿï¼ˆç”¨æˆ·ç«¯ï¼‰</title>
    <style>
        /* å…¨å±€é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1500px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: #666;
        }
        .tab.active {
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        /* å­æ ‡ç­¾é¡µæ ·å¼ */
        .sub-tabs {
            display: flex;
            margin: 15px 0;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
        }
        .sub-tab {
            padding: 8px 16px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }
        .sub-tab.active {
            color: #007bff;
            border-bottom: 2px solid #007bff;
        }
        .sub-page {
            display: none;
        }
        .sub-page.active {
            display: block;
        }
        /* æŒ‰é’®é€šç”¨æ ·å¼ */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .upload-btn, .search-btn, .pai-gu-search-btn {
            background-color: #007bff;
            color: white;
        }
        .upload-btn:hover, .search-btn:hover, .pai-gu-search-btn:hover {
            background-color: #0056b3;
        }
        .reset-search-btn, .pai-gu-reset-btn {
            background-color: #6c757d;
            color: white;
            margin-left: 10px;
        }
        .reset-search-btn:hover, .pai-gu-reset-btn:hover {
            background-color: #5a6268;
        }
        .export-btn {
            background-color: #28a745;
            color: white;
            margin-right: 10px;
        }
        .export-btn:hover {
            background-color: #218838;
        }
        /* ç­›é€‰æŒ‰é’®æ ·å¼ä¿®æ”¹ï¼šæœ‰åº“å­˜ç»¿è‰²ï¼Œå·²å”®ç½„çº¢è‰² */
        .filter-btn {
            color: #212529;
            margin-left: 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        #filterAllBtn {
            background-color: #ffc107;
        }
        #filterAllBtn:hover {
            background-color: #e0a800;
        }
        #filterInStockBtn {
            background-color: #28a745; /* æœ‰åº“å­˜æŒ‰é’®ç»¿è‰² */
            color: white;
        }
        #filterInStockBtn:hover {
            background-color: #218838;
        }
        #filterOutOfStockBtn {
            background-color: #dc3545; /* å·²å”®ç½„æŒ‰é’®çº¢è‰² */
            color: white;
        }
        #filterOutOfStockBtn:hover {
            background-color: #c82333;
        }
        .filter-btn.active {
            box-shadow: 0 0 0 2px rgba(255,255,255,0.5), 0 0 0 4px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        /* ç»“ç®—ç»Ÿè®¡é¡µé¢æ ·å¼ */
        .search-container {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        .search-input {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 300px;
        }
        #summary-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px; /* å¤šä¸ªCNå¡ç‰‡ä¹‹é—´çš„é—´è· */
        }
        .summary-card {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .summary-card h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        .summary-header {
            display: flex;
            justify-content: space-between;
            padding: 8px 15px;
            background-color: #e9ecef;
            border-radius: 4px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
        }
        .summary-header .img-col {
            width: 80px;
            text-align: center;
        }
        .summary-header .category-col {
            flex: 1;
            margin-left: 10px;
        }
        .summary-header .quantity-col, .summary-header .cost-col {
            width: 120px;
            text-align: center;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-bottom: 1px dashed #eee;
            align-items: center;
        }
        .summary-item:last-child {
            border-bottom: none;
        }
        .summary-item .img-col {
            width: 80px;
            text-align: center;
        }
        .summary-item .img-col img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid #eee;
        }
        .summary-item .img-col img:hover {
            transform: scale(1.05);
        }
        .summary-item .category-col {
            flex: 1;
            margin-left: 10px;
        }
        .summary-item .quantity-col, .summary-item .cost-col {
            width: 120px;
            text-align: center;
        }
        .summary-total {
            margin-top: 15px;
            padding: 12px 15px;
            background-color: #e8f4f8;
            border-radius: 4px;
            font-weight: bold;
            font-size: 16px;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .summary-total .total-label {
            color: #dc3545;
        }
        .summary-total .total-values {
            display: flex;
            gap: 30px;
        }
        /* å›¾ç‰‡æ”¾å¤§å¼¹çª— */
        .img-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .img-modal-content {
            max-width: 90%;
            max-height: 90%;
        }
        .img-modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .img-modal-close:hover {
            color: #ddd;
        }
        /* åº“å­˜å¡ç‰‡ç¿»è½¬æ ·å¼ */
        .stock-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
            padding: 10px;
        }
        .stock-card {
            perspective: 1000px;
            height: 450px;
            cursor: pointer;
            display: none; /* é»˜è®¤éšè—ï¼Œæ ¹æ®ç­›é€‰/æœç´¢æ˜¾ç¤º */
        }
        .stock-card.visible {
            display: block; /* ç¬¦åˆæ¡ä»¶çš„æ˜¾ç¤º */
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-radius: 12px;
        }
        .stock-card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .card-front {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
        }
        .card-front::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #007bff, #28a745);
        }
        .stock-card.out-of-stock .card-front::before {
            background: linear-gradient(90deg, #dc3545, #ffc107);
        }
        .card-front img {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin: 15px auto;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .card-front .category-name {
            font-weight: 600;
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .card-front .stock-num {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
            color: #28a745;
        }
        .stock-card.out-of-stock .card-front .stock-num {
            color: #dc3545;
            text-decoration: line-through;
        }
        .card-front .stock-status {
            font-size: 14px;
            color: #6c757d;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            background-color: rgba(40, 167, 69, 0.1);
            color: #28a745;
            margin-top: 8px;
        }
        .stock-card.out-of-stock .card-front .stock-status {
            background-color: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        .card-front .kunxu-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 2px 8px;
            background-color: #007bff;
            color: white;
            border-radius: 12px;
        }
        .card-front .price-info {
            margin-top: 8px;
            font-size: 16px;
            color: #007bff;
            font-weight: 600;
        }
        /* å¡ç‰‡èƒŒé¢æ ·å¼ä¿®æ”¹ï¼šæ·»åŠ è°·å­å›¾ç‰‡æ¨¡ç³ŠèƒŒæ™¯ */
        .card-back {
            background: #fff;
            border: 1px solid #dee2e6;
            transform: rotateY(180deg);
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 30px 20px;
            overflow-y: auto;
            position: relative;
        }
        /* æ¨¡ç³ŠèƒŒæ™¯å›¾ç‰‡å±‚ */
        .card-back::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(8px);
            opacity: 0.15;
            z-index: 0;
            border-radius: 12px;
        }
        /* ç¡®ä¿å†…å®¹åœ¨èƒŒæ™¯ä¸Šå±‚ */
        .card-back > * {
            position: relative;
            z-index: 1;
        }
        .card-back h3 {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
            background-color: rgba(255,255,255,0.8);
            padding: 5px 15px;
            border-radius: 8px;
        }
        .claim-form-group {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background-color: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 8px;
        }
        .claim-form-group label {
            font-weight: 500;
            color: #666;
            font-size: 14px;
        }
        .claim-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .claim-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        .quantity-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .quantity-tip {
            font-size: 12px;
            color: #999;
            text-align: right;
        }
        .claim-btn {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }
        .claim-btn:hover {
            background-color: #0056b3;
        }
        .claim-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .close-btn:hover {
            background-color: #e9ecef;
        }
        /* å·²å”®ç½„å¡ç‰‡èƒŒé¢æ ·å¼ */
        .claimers-list {
            width: 100%;
            padding: 10px;
            background-color: rgba(248, 249, 250, 0.95);
            border-radius: 6px;
            max-height: 280px;
            overflow-y: auto;
            position: relative;
            z-index: 1;
        }
        .claimers-list h4 {
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 8px;
            text-align: center;
        }
        .claimers-item {
            padding: 6px 10px;
            border-bottom: 1px dashed #eee;
            font-size: 14px;
            color: #495057;
        }
        .claimers-item:last-child {
            border-bottom: none;
        }
        .claimers-stat {
            margin-top: 10px;
            font-size: 14px;
            color: #6c757d;
            text-align: center;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }
        /* åº“å­˜æ€»é‡‘é¢ç»Ÿè®¡å¡ç‰‡ */
        .stock-total-card {
            padding: 15px;
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8fb 100%);
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin-bottom: 20px;
            text-align: center;
        }
        .stock-total-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .stock-total-amount {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        /* åº“å­˜é¡µé¢æœç´¢ç­›é€‰æ  */
        .stock-search-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .stock-search-input {
            flex: 1;
            min-width: 200px;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        /* åŒæ­¥æç¤º */
        .sync-tip {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border-radius: 4px;
            z-index: 1000;
            display: none;
        }
        /* å¯¼å‡ºä½™é‡å›¾ç›¸å…³æ ·å¼ - æ²¿ç”¨åº“å­˜å¡ç‰‡è®¾è®¡ */
        .export-stock-container {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .export-stock-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 15px;
        }
        .grid-size-select {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .preview-btn {
            background-color: #17a2b8;
            color: white;
        }
        .preview-btn:hover {
            background-color: #138496;
        }
        .preview-container {
            display: none;
            margin-top: 15px;
            padding: 20px;
            border: 1px dashed #007bff;
            border-radius: 8px;
            background-color: #fff;
        }
        .preview-container.visible {
            display: block;
        }
        .preview-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        /* æ‰“å°æŒ‰é’®æ ·å¼ */
        .print-btn {
            background-color: #6f42c1;
            color: white;
        }
        
        .print-btn:hover {
            background-color: #5a32a3;
        }
        /* ç½‘æ ¼å¸ƒå±€çš„ä½™é‡å›¾æ ·å¼ - æ²¿ç”¨åº“å­˜å¡ç‰‡è®¾è®¡ */
        .stock-grid-preview {
            display: grid;
            gap: 20px;
            justify-content: center;
            margin: 0 auto;
        }
        .grid-3x3 {
            grid-template-columns: repeat(3, 280px);
        }
        .grid-4x4 {
            grid-template-columns: repeat(4, 240px);
        }
        .grid-5x5 {
            grid-template-columns: repeat(5, 220px);
        }
        /* ä½™é‡å›¾å¡ç‰‡ - æ²¿ç”¨åº“å­˜å¡ç‰‡è®¾è®¡ï¼Œä½†è°ƒæ•´æ ·å¼ */
        .export-card-front {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .export-card-front::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #007bff, #28a745);
        }
        
        .export-card-front.out-of-stock::before {
            background: linear-gradient(90deg, #dc3545, #ffc107);
        }
        
        .export-card-front img {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin: 15px auto;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        
        /* ä½™é‡æ•°å­—æ”¾åœ¨å›¾ç‰‡å³ä¸‹è§’ */
        .export-card-front .stock-num-overlay {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px; /* ç¼©å°ä½™é‡æ•°å­—å­—ä½“å¤§å° */
            font-weight: bold;
            color: #28a745;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 2px solid #fff;
        }
        
        .export-card-front.out-of-stock .stock-num-overlay {
            color: #dc3545;
            text-decoration: line-through;
        }
        
        .export-card-front .category-name {
            font-weight: 600;
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 90%;
        }
        
        /* å•ä»·ä¿¡æ¯ - æ”¾å¤§å­—ä½“ */
        .export-card-front .price-info {
            margin-top: 10px;
            font-size: 20px; /* å¢å¤§å•ä»·å­—ä½“å¤§å° */
            color: #007bff;
            font-weight: 700;
        }
        
        /* æ†åºæ ‡ç­¾ */
        .export-card-front .kunxu-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 2px 8px;
            background-color: #007bff;
            color: white;
            border-radius: 12px;
        }
        
        /* ç”¨äºæ‰“å°çš„ä¸´æ—¶å®¹å™¨ */
        #exportTempContainer {
            position: fixed;
            top: -9999px;
            left: -9999px;
            background-color: #fff;
            padding: 20px;
            z-index: -1;
        }
        
        /* æ‰“å°æ ·å¼ - éšè—ä¸å¿…è¦å…ƒç´ ï¼Œä¼˜åŒ–æ‰“å°å¸ƒå±€ */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #previewContainer, 
            #previewContainer * {
                visibility: visible;
            }
            
            #previewContainer {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
                border: none;
                box-shadow: none;
                background: white;
            }
            
            .preview-title {
                font-size: 24px !important;
                margin-bottom: 30px !important;
                padding-bottom: 15px !important;
            }
            
            .stock-grid-preview {
                gap: 20px !important;
                margin-bottom: 40px !important;
            }
            
            .export-card-front {
                border: 2px solid #333 !important;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
            }
            
            .category-name {
                font-size: 16px !important;
                font-weight: 700 !important;
            }
            
            .stock-num-overlay {
                font-size: 22px !important;
                font-weight: 800 !important;
            }
            
            .price-info {
                font-size: 22px !important;
                font-weight: 700 !important;
            }
            
            /* éšè—æ‰€æœ‰æŒ‰é’® */
            .btn, button, .print-btn {
                display: none !important;
            }
        }
        /* æç¤ºä¿¡æ¯æ ·å¼ */
        .export-tips {
            background-color: #e8f4f8;
            border-left: 4px solid #007bff;
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 14px;
            color: #2c3e50;
        }
        .export-tips ul {
            margin: 5px 0 5px 20px;
        }
        .export-tips li {
            margin-bottom: 3px;
        }
        
        /* ç™»å½•æŒ‰é’®æ ·å¼ */
        #authButtons {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        #authButtons .btn {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        #logoutBtn {
            background-color: #dc3545;
            color: white;
        }
        
        #logoutBtn:hover {
            background-color: #c82333;
        }
        
        #reLoginBtn {
            background-color: #6c757d;
            color: white;
        }
        
        #reLoginBtn:hover {
            background-color: #5a6268;
        }
        
        /* ç™»å½•æ¨¡æ€æ¡†æ ·å¼ */
        #loginModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        #loginModal .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }
        
        #loginModal .form-group {
            margin: 20px 0;
        }
        
        #loginModal .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        #loginModal .help-text {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-size: 14px;
            margin: 15px 0;
        }
        
        #loginModal .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        #loginModal .btn-primary {
            background: #007bff;
            color: white;
        }
        
        #loginModal .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        #loginModal .btn-gh-link {
            background: #24292e;
            color: white;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
        }
        
        #loginModal .btn-gh-link:hover {
            background: #000;
        }
        
        #loginModal .token-steps {
            margin-top: 15px;
            padding-left: 20px;
        }
        
        #loginModal .token-steps li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        /* æŸ¥çœ‹è®¤é¢†æƒ…å†µæŒ‰é’®æ ·å¼ */
        .view-claims-btn {
            width: 100%;
            padding: 10px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .view-claims-btn:hover {
            background-color: #5a6268;
        }

        /* è®¤é¢†è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
        .claims-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .claims-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
        }
        
        .claims-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .claims-modal-close:hover {
            background-color: #e9ecef;
        }
        
        .claims-modal h3 {
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .claims-statistics {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .stat-item {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-item .stat-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .stat-item .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #007bff;
        }
        
        .claims-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .claims-table th {
            background-color: #e9ecef;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }
        
        .claims-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            color: #495057;
        }
        
        .claims-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .no-claims {
            text-align: center;
            padding: 30px;
            color: #6c757d;
            font-style: italic;
        }
    </style>
    <!-- å¼•å…¥SheetJSåº“ç”¨äºExcelå¯¼å‡º -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- å¼•å…¥html2canvasç”¨äºæˆªå›¾å¯¼å‡º -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- å¼•å…¥Gistå·¥å…·åº“ -->
    <script src="gist-utils.js"></script>
</head>
<body>
    <!-- å³ä¸Šè§’ç™»å½•æŒ‰é’® -->
    <div id="authButtons" style="display: none;">
        <button id="logoutBtn" class="btn" onclick="logoutToken()">é€€å‡ºç™»å½•</button>
    </div>
    
    <div class="container">
        <!-- ä¸»æ ‡ç­¾é¡µåˆ‡æ¢ï¼ˆä»…ä¿ç•™ç»“ç®—ã€åº“å­˜ï¼‰ -->
        <div class="tabs">
            <button class="tab" onclick="switchPage('summary-page')">ç»“ç®—ç»Ÿè®¡</button>
            <button class="tab active" onclick="switchPage('stock-page')">æ’è°·/ä½™é‡</button>
        </div>

        <!-- ç»“ç®—ç»Ÿè®¡é¡µé¢ -->
        <div id="summary-page" class="page">
            <h2>ä¸ªäººç»“ç®—ç»Ÿè®¡</h2>
			<div class="settlement-tips" style="margin: 15px 0; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border-left: 4px solid #28a745;">
    <strong>ä¸ªäººç»“ç®—å•ä½¿ç”¨æç¤ºï¼š</strong>
    <ul style="margin: 10px 0 0 20px; line-height: 1.6;">
        <li>åœ¨æœç´¢æ¡†è¾“å…¥CNåç§°ï¼ˆæ”¯æŒæ¨¡ç³Šæœç´¢ï¼‰ï¼Œç‚¹å‡»ã€Œæœç´¢ã€æŸ¥è¯¢å¯¹åº”ç”¨æˆ·çš„ç»“ç®—æ•°æ®</li>
        <li>ç»“ç®—å•å±•ç¤ºè¯¥CNè®¤é¢†çš„è°·å­å“ç±»ã€æ•°é‡ã€é‡‘é¢ï¼Œåº•éƒ¨æ±‡æ€»æ€»è®¡é‡‘é¢</li>
        <li>ç‚¹å‡»ç»“ç®—å•å†…è°·å­å›¾ç‰‡å¯æ”¾å¤§é¢„è§ˆï¼Œç‚¹å‡»å¼¹çª—å³ä¸Šè§’å…³é—­æŒ‰é’®é€€å‡ºé¢„è§ˆ</li>
        <li>ç‚¹å‡»ã€Œé‡ç½®ã€æŒ‰é’®å¯æ¸…ç©ºæœç´¢æ¡ä»¶ï¼Œæ¢å¤åˆå§‹é¡µé¢çŠ¶æ€</li>
    </ul>
</div>
            <div class="search-container">
                <input type="text" class="search-input" id="cnSearchInput" placeholder="è¯·è¾“å…¥è¦æŸ¥è¯¢çš„CNåç§°ï¼ˆæ”¯æŒæ¨¡ç³Šæœç´¢ï¼‰">
                <button class="btn search-btn" onclick="searchCN()">æœç´¢</button>
                <button class="btn reset-search-btn" onclick="resetSearch()">é‡ç½®</button>
            </div>
            <div id="summary-container"></div>
        </div>

        <!-- æ–°ç‰ˆåº“å­˜ä½™é‡+æ’è°·é¡µé¢ -->
        <div id="stock-page" class="page active">
            <h2>å¿«è®¤é¢†ä½ çš„è°·å­å§~</h2>
            
            <!-- åº“å­˜é¡µé¢å­æ ‡ç­¾é¡µ -->
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchSubPage('stock-main')">æ’è°·ï¼ˆç‚¹å‡»å¡ç‰‡è®¤é¢†è°·å­ï¼‰</button>
                <button class="sub-tab" onclick="switchSubPage('stock-export')">ä½™é‡å›¾å¯¼å‡º</button>
            </div>
            
            <!-- åº“å­˜å¡ç‰‡å­é¡µé¢ -->
            <div id="stock-main" class="sub-page active">
				<div class="pai-gu-tips" style="margin: 15px 0; padding: 15px; background-color: #f8f9fa; border-radius: 6px; border-left: 4px solid #007bff;">
    <strong>æ’è°·ä½¿ç”¨æç¤ºï¼š</strong>
    <ul style="margin: 10px 0 0 20px; line-height: 1.6;">
        <li>é»˜è®¤å±•ç¤ºæœ‰åº“å­˜è°·å­ï¼Œå¯é€šè¿‡ã€Œå…¨éƒ¨/æœ‰åº“å­˜/å·²å”®ç½„ã€æŒ‰é’®åˆ‡æ¢ç­›é€‰çŠ¶æ€</li>
        <li>ç‚¹å‡»è°·å­å¡ç‰‡å¯ç¿»è½¬ï¼Œæœªå”®ç½„å¡ç‰‡æ”¯æŒå¡«å†™CNã€è®¤é¢†æ•°é‡å®Œæˆè®¤é¢†ï¼›å·²å”®ç½„å¡ç‰‡å¯æŸ¥çœ‹è®¤é¢†åˆ—è¡¨</li>
        <li>æœç´¢æ¡†è¾“å…¥ã€Œå“ç±»/æ†åºã€å…³é”®è¯ï¼Œå¯å¿«é€Ÿå®šä½ç›®æ ‡è°·å­ï¼Œç‚¹å‡»ã€Œé‡ç½®ã€æ¸…ç©ºç­›é€‰æ¡ä»¶</li>
        <li>é¡µé¢é¡¶éƒ¨å¡ç‰‡å®æ—¶å±•ç¤ºå½“å‰æœ‰åº“å­˜çš„è°·å­æ€»é‡‘é¢</li>
    </ul>
</div>
                <div class="stock-search-filter">
                    <input type="text" class="stock-search-input" id="stockSearchInput" placeholder="æœç´¢å“ç±»/æ†åº...">
                    <button class="btn search-btn" onclick="searchStock()">æœç´¢</button>
                    <button class="btn reset-search-btn" onclick="resetStockSearch()">é‡ç½®</button>
                    <button class="btn filter-btn" id="filterAllBtn" onclick="filterStock('all')">å…¨éƒ¨</button>
                    <button class="btn filter-btn active" id="filterInStockBtn" onclick="filterStock('inStock')">æœ‰åº“å­˜</button>
                    <button class="btn filter-btn" id="filterOutOfStockBtn" onclick="filterStock('outOfStock')">å·²å”®ç½„</button>
                </div>
                
                <div id="stock-total-card" class="stock-total-card">
                    <h3>åº“å­˜è°·å­æ€»é‡‘é¢</h3>
                    <div class="stock-total-amount">Â¥0.00</div>
                </div>
                <div id="stock-container" class="stock-container"></div>
            </div>
            
            <!-- ä½™é‡å›¾å¯¼å‡ºå­é¡µé¢ -->
            <div id="stock-export" class="sub-page">
                <h3>åº“å­˜ä½™é‡å›¾å¯¼å‡º</h3>
              
                <div class="export-stock-container">
                    <div class="export-tips">
                        <strong>ä½¿ç”¨æç¤ºï¼š</strong>
                        <ul>
                            <li>å…ˆé€‰æ‹©æ‰“å°ä½™é‡å›¾çš„è§„æ ¼ï¼Œç¡®è®¤åç‚¹å‡»"ç¡®è®¤è§„æ ¼"æŸ¥çœ‹æ•ˆæœåï¼Œæœ€åæŒ‰"æ‰“å°"å¼€å§‹æ‰“å°</li>
                            <li>ä½¿ç”¨iphone safariæ‰“å°æ—¶ï¼Œæ¨èä½¿ç”¨è§„æ ¼5*5 ç¼©æ”¾35%æ•ˆæœæ¯”è¾ƒå¥½</li>
                            <li>ä½™é‡å›¾é‡‡ç”¨ä¸åº“å­˜å¡ç‰‡ç›¸åŒçš„è®¾è®¡ï¼Œä½™é‡æ•°å­—æ˜¾ç¤ºåœ¨å›¾ç‰‡å³ä¸‹è§’ï¼Œæ†åºä¸Šè°·å­å³ä¸Šè§’ä¼šæ˜¾ç¤ºæ†åº</li>
                            <li>è§„æ ¼é¢„è§ˆæ•ˆæœä»…ä½œå‚è€ƒï¼Œä¼šå› ä¸ºä½¿ç”¨çš„æµè§ˆå™¨ä¸åŒï¼Œæ‰“å°æ•ˆæœæœ‰æ‰€å·®åˆ«</li>
                        </ul>
                    </div>
                    
                    <div class="export-stock-controls">
                        <label for="gridSize">é€‰æ‹©ç½‘æ ¼å¸ƒå±€ï¼š</label>
                        <select id="gridSize" class="grid-size-select">
                            <option value="3x3">3Ã—3ï¼ˆ9ä¸ª/å¼ ï¼‰</option>
                            <option value="4x4">4Ã—4ï¼ˆ16ä¸ª/å¼ ï¼‰</option>
                            <option value="5x5">5Ã—5ï¼ˆ25ä¸ª/å¼ ï¼‰</option>
                        </select>
                        <button class="btn preview-btn" onclick="previewStockGrid()">ç¡®è®¤è§„æ ¼</button>
                        <button class="btn print-btn" onclick="printPreview()" disabled>æ‰“å°</button>
                    </div>
                    <div id="previewContainer" class="preview-container">
                        <div class="preview-title">ä½™é‡å›¾è§„æ ¼ï¼š<span id="previewInfo">0å¼ å›¾ï¼Œæ¯å¼ åŒ…å«0ä¸ªå“ç±»</span></div>
                        <div id="stockPreviewGrid" class="stock-preview-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div class="img-modal" id="imgModal">
        <span class="img-modal-close" onclick="closeImgModal()">&times;</span>
        <img class="img-modal-content" id="modalImg">
    </div>
    
    <!-- è®¤é¢†è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="claims-modal" id="claimsModal">
        <div class="claims-modal-content">
            <button class="claims-modal-close" onclick="closeClaimsModal()">Ã—</button>
            <h3 id="claimsModalTitle">è®¤é¢†è¯¦æƒ…</h3>
            <div class="claims-statistics">
                <div class="stat-item">
                    <div class="stat-label">æ€»åº“å­˜</div>
                    <div class="stat-value" id="totalStock">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å‰©ä½™åº“å­˜</div>
                    <div class="stat-value" id="remainingStock">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å·²è®¤é¢†</div>
                    <div class="stat-value" id="claimedCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">è®¤é¢†äººæ•°</div>
                    <div class="stat-value" id="claimersCount">0</div>
                </div>
            </div>
            <div id="claimsList">
                <table class="claims-table">
                    <thead>
                        <tr>
                            <th>è®¤é¢†äºº</th>
                            <th>è®¤é¢†æ•°é‡</th>
                        </tr>
                    </thead>
                    <tbody id="claimsTableBody">
                        <!-- è®¤é¢†è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                <div id="noClaimsMessage" class="no-claims" style="display: none;">
                    æš‚æ— è®¤é¢†è®°å½•
                </div>
            </div>
        </div>
    </div>
    
    <!-- åŒæ­¥æç¤º -->
    <div class="sync-tip" id="syncTip">æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯ï¼</div>
    
    <!-- å¯¼å‡ºä¸´æ—¶å®¹å™¨ -->
    <div id="exportTempContainer"></div>
    
    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal">
        <div class="modal-content">
            <h3>ğŸ” ç™»å½•</h3>
            <p>éœ€è¦ è¾“å…¥å¯†é’¥ç™»å½• æ¥åŒæ­¥æ•°æ®åˆ°äº‘ç«¯</p>
            
            <div class="form-group">
                <label for="tokenInput">Password</label>
                <input type="password" id="tokenInput" class="form-control" 
                       placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                       autocomplete="off">
                <small style="color: #666; display: block; margin-top: 5px;">
                    å¯†é’¥ä»…ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šå‘é€åˆ°ä»»ä½•æœåŠ¡å™¨;
                </small>
                <small style="color: #666; display: block; margin-top: 5px;">
                    ä¸ä½¿ç”¨ç‰¹å®šç§˜é’¥æ—¶ï¼Œä¸èƒ½å¤Ÿå°†æ’è°·æ•°æ®ä¸Šä¼ äº‘ç«¯ã€‚
                </small>
            </div>
            
                        
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="submitToken()" style="flex: 1;">ç¡®è®¤å¹¶ç™»å½•</button>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        let guziData = [];          
        let claimRecords = [];      
        const defaultImgUrl = "https://via.placeholder.com/180";
        let currentSearchCN = '';   
        let currentStockFilter = 'inStock'; 
        let currentStockSearch = '';
        let previewedGridData = []; // å­˜å‚¨é¢„è§ˆçš„ç½‘æ ¼æ•°æ®
        let currentGridSize = '3x3'; // å½“å‰é€‰æ‹©çš„ç½‘æ ¼å°ºå¯¸
        let currentExportFilter = 'inStock';
        let currentExportSearch = '';
        let currentClaimDetailsIndex = -1; // å½“å‰æŸ¥çœ‹è®¤é¢†è¯¦æƒ…çš„è°·å­ç´¢å¼•
        
        // ç™»å½•çŠ¶æ€
        let isLoggedIn = false;

        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', async function() {
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            await checkLoginStatus();
            
            // å¦‚æœå·²ç™»å½•ï¼ŒåŠ è½½æ•°æ®
            if (isLoggedIn) {
                await loadData();
            }
        });

        // ==================== ç™»å½•ç›¸å…³åŠŸèƒ½ ====================
        async function checkLoginStatus() {
            const token = getGistToken();
            if (!token) {
                // æ²¡æœ‰tokenï¼Œæ˜¾ç¤ºç™»å½•æ¡†
                showLoginModal();
                return;
            }
            
            // éªŒè¯tokenæœ‰æ•ˆæ€§
            try {
                const isValid = await validateToken(token);
                if (!isValid) {
                    // Tokenæ— æ•ˆï¼Œæ¸…é™¤å¹¶æç¤ºé‡æ–°ç™»å½•
                    clearGistToken();
                    alert('å¯†é’¥ æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                    showLoginModal();
                    return;
                }
                
                // Tokenæœ‰æ•ˆï¼Œæ˜¾ç¤ºç™»å½•æŒ‰é’®
                isLoggedIn = true;
                document.getElementById('authButtons').style.display = 'flex';
            } catch (error) {
                console.error('éªŒè¯ å¯†é’¥ å¤±è´¥:', error);
                alert('éªŒè¯ å¯†é’¥ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                showLoginModal();
            }
        }

        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('authButtons').style.display = 'none';
            isLoggedIn = false;
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('tokenInput').value = '';
        }

        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        async function submitToken() {
            const tokenInput = document.getElementById('tokenInput');
            const token = tokenInput.value.trim();
            
            if (!token) {
                alert('è¯·è¾“å…¥ å¯†é’¥');
                tokenInput.focus();
                return;
            }
            
            // éªŒè¯Tokenæ ¼å¼
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                if (!confirm('å¯†é’¥ æ ¼å¼ä¼¼ä¹ä¸æ­£ç¡®ã€‚æ ‡å‡†çš„å¯†é’¥ä»¥"ghp_"å¼€å¤´ã€‚\n\næ˜¯å¦ç»§ç»­ä½¿ç”¨è¿™ä¸ªTokenï¼Ÿ')) {
                    tokenInput.focus();
                    return;
                }
            }
            
            try {
                // éªŒè¯Tokenæœ‰æ•ˆæ€§
                const isValid = await validateToken(token);
                if (!isValid) {
                    alert('å¯†é’¥ æ— æ•ˆï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ­£ç¡®');
                    return;
                }
                
                // ä¿å­˜Token
                setGistToken(token);
                isLoggedIn = true;
                
                // éšè—ç™»å½•æ¡†ï¼Œæ˜¾ç¤ºç™»å½•æŒ‰é’®
                hideLoginModal();
                document.getElementById('authButtons').style.display = 'flex';
                
                // åŠ è½½æ•°æ®
                await loadData();
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showSyncTip('ç™»å½•æˆåŠŸï¼æ•°æ®å·²åŠ è½½');
            } catch (error) {
                console.error('æäº¤å¯†é’¥å¤±è´¥:', error);
                alert('ç™»å½•å¤±è´¥ï¼š' + error.message);
            }
        }

        function logoutToken() {
            if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿè¿™å°†æ¸…é™¤ä½ çš„ç™»å½•è®°å½•ï¼Œä¸‹æ¬¡éœ€è¦é‡æ–°è¾“å…¥å¯†é’¥ï¼Œä½†ä¸ä¼šåˆ é™¤äº‘ç«¯æ•°æ®ã€‚')) {
                return;
            }
            
            // æ¸…é™¤Token
            clearGistToken();
            isLoggedIn = false;
            
            // æ¸…ç©ºé¡µé¢æ•°æ®
            guziData = [];
            claimRecords = [];
            
            // æ¸…ç©ºé¡µé¢æ˜¾ç¤º
            document.getElementById('stock-container').innerHTML = '';
            document.getElementById('summary-container').innerHTML = '';
            document.querySelector('.stock-total-amount').innerText = 'Â¥0.00';
            
            // éšè—ç™»å½•æŒ‰é’®ï¼Œæ˜¾ç¤ºç™»å½•æ¡†
            document.getElementById('authButtons').style.display = 'none';
            showLoginModal();
            
            showSyncTip('å·²é€€å‡ºç™»å½•');
        }

        // ==================== æ•°æ®åŠ è½½ ====================
        async function loadData() {
            try {
                const data = await fetchGuziDataFromGist();
                guziData = data.guziData;
                claimRecords = data.claimRecords;
                
                renderStockPage();
                renderSummaryPage();
                
                // è®¾ç½®äº‹ä»¶ç›‘å¬
                setupEventListeners();
                
                showSyncTip('æ•°æ®åŠ è½½æˆåŠŸ');
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                
                if (error.message.includes('Token') || error.message.includes('401') || error.message.includes('403')) {
                    alert('å¯†é’¥æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°å°è¯•æˆ–è”ç³»ç®¡ç†å‘˜');
                    logoutToken();
                } else {
                    alert('åŠ è½½æ•°æ®å¤±è´¥ï¼š' + error.message);
                }
            }
        }

        function setupEventListeners() {
            // ç›‘å¬ç½‘æ ¼å°ºå¯¸é€‰æ‹©å˜åŒ–
            document.getElementById('gridSize').addEventListener('change', function() {
                currentGridSize = this.value;
            });
            
            // ç»“ç®—é¡µé¢æœç´¢æ¡†æ”¯æŒå›è½¦æœç´¢
            document.getElementById('cnSearchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchCN();
            });
            
            // åº“å­˜ä¸»é¡µé¢æœç´¢æ¡†æ”¯æŒå›è½¦æœç´¢
            document.getElementById('stockSearchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchStock();
            });
            
            // ç™»å½•æ¡†è¾“å…¥æ¡†æ”¯æŒå›è½¦æäº¤
            document.getElementById('tokenInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') submitToken();
            });
            
            // ç‚¹å‡»ç™»å½•æ¡†å¤–éƒ¨å…³é—­
            document.getElementById('loginModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideLoginModal();
                }
            });
            
            // ç‚¹å‡»è®¤é¢†è¯¦æƒ…æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            document.getElementById('claimsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeClaimsModal();
                }
            });
        }

        // ==================== æ•°æ®åŒæ­¥å‡½æ•° ====================
        function saveDataToLocalStorage() {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•æ‰èƒ½ä¿å­˜æ•°æ®');
                showLoginModal();
                return;
            }
            
            syncGuziDataToGist(guziData, claimRecords);
            showSyncTip();
        }

        // ==================== è¾…åŠ©å‡½æ•° ====================
        function showSyncTip(message = 'æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯ï¼') {
            const tip = document.getElementById('syncTip');
            tip.textContent = message;
            tip.style.display = "block";
            setTimeout(() => tip.style.display = "none", 3000);
        }

        // ==================== é¡µé¢åˆ‡æ¢å‡½æ•° ====================
        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
        }
        
        function switchSubPage(subPageId) {
            document.querySelectorAll('.sub-page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.sub-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(subPageId).classList.add('active');
            event.target.classList.add('active');
        }

        // ==================== åº“å­˜ä¸»é¡µé¢åŠŸèƒ½ ====================
        function renderStockPage() {
            const stockContainer = document.getElementById('stock-container');
            stockContainer.innerHTML = '';
            
            // è®¡ç®—åº“å­˜æ€»é‡‘é¢
            let totalAmount = 0;
            guziData.forEach(item => {
                totalAmount += item.price * item.stock;
            });
            document.querySelector('.stock-total-amount').innerText = `Â¥${totalAmount.toFixed(2)}`;
            
            // æ¸²æŸ“åº“å­˜å¡ç‰‡
            guziData.forEach((item, index) => {
                const isOutOfStock = item.stock <= 0;
                const card = document.createElement('div');
                card.className = `stock-card ${isOutOfStock ? 'out-of-stock' : ''}`;
                card.dataset.index = index;
                
                // ç­›é€‰é€»è¾‘
                let isVisible = true;
                if (currentStockFilter === 'inStock' && isOutOfStock) isVisible = false;
                if (currentStockFilter === 'outOfStock' && !isOutOfStock) isVisible = false;
                if (currentStockSearch && !item.category.toLowerCase().includes(currentStockSearch.toLowerCase()) && 
                    !item.kunxu.toLowerCase().includes(currentStockSearch.toLowerCase())) {
                    isVisible = false;
                }
                
                if (isVisible) card.classList.add('visible');
                
                // è·å–è°·å­å›¾ç‰‡åœ°å€
                const imgSrc = item.imgSrc || defaultImgUrl;
                
                // æ„å»ºå¡ç‰‡å†…å®¹
                let cardBackContent = '';
                if (isOutOfStock) {
                    // å·²å”®ç½„å¡ç‰‡ï¼šå±•ç¤ºè®¤é¢†äººåˆ—è¡¨
                    const claimersMap = {};
                    item.claimers.forEach(name => {
                        claimersMap[name] = (claimersMap[name] || 0) + 1;
                    });
                    const claimersList = Object.entries(claimersMap).map(([name, count]) => 
                        `<div class="claimers-item">${name}ï¼š${count}ä¸ª</div>`
                    ).join('');
                    
                    cardBackContent = `
                        <h3>${item.category} è®¤é¢†è®°å½•</h3>
                        <div class="claimers-list">
                            <h4>è®¤é¢†äººåˆ—è¡¨ï¼ˆå…±${item.claimers.length}ä¸ªï¼‰</h4>
                            ${claimersList || '<div class="claimers-item">æš‚æ— è®¤é¢†è®°å½•</div>'}
                        </div>
                        <div class="claimers-stat">
                            æ€»è®¤é¢†æ•°é‡ï¼š${item.claimers.length} ä¸ª
                        </div>
                    `;
                } else {
                    // æœ‰åº“å­˜å¡ç‰‡ï¼šå±•ç¤ºè®¤é¢†è¡¨å•
                    cardBackContent = `
                        <h3>è®¤é¢† ${item.category}</h3>
                        <button class="view-claims-btn" onclick="showClaimDetails(${index})">æŸ¥çœ‹è®¤é¢†æƒ…å†µ</button>
                        <div class="claim-form-group">
                            <label for="claimer-name-${index}">è®¤é¢†äººCN</label>
                            <input type="text" id="claimer-name-${index}" class="claim-input" placeholder="è¯·è¾“å…¥ä½ çš„CNåç§°">
                        </div>
                        <div class="claim-form-group">
                            <label for="claim-quantity-${index}">è®¤é¢†æ•°é‡</label>
                            <input type="number" id="claim-quantity-${index}" class="quantity-input" min="1" max="${item.stock}" value="1">
                            <div class="quantity-tip">å‰©ä½™å¯è®¤é¢†ï¼š${item.stock} ä¸ª</div>
                        </div>
                        <button class="claim-btn" onclick="submitClaim(${index})">ç¡®è®¤è®¤é¢†</button>
                    `;
                }
                
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            ${item.kunxu !== 'ä¸æ†' ? `<div class="kunxu-tag">${item.kunxu}</div>` : ''}
                            <img src="${imgSrc}" alt="${item.category}">
                            <div class="category-name">${item.category}</div>
                            <div class="stock-num">${item.stock}</div>
                            <div class="stock-status">${isOutOfStock ? 'å·²å”®ç½„' : 'å¯è®¤é¢†'}</div>
                            <div class="price-info">å•ä»·ï¼šÂ¥${item.price.toFixed(2)}</div>
                        </div>
                        <div class="card-back" style="--bg-img: url('${imgSrc}')">
                            <style>
                                .card-back[data-index="${index}"]::before {
                                    background-image: var(--bg-img);
                                }
                            </style>
                            <button class="close-btn" onclick="flipStockCard(${index})">Ã—</button>
                            ${cardBackContent}
                        </div>
                    </div>
                `;
                
                // ç»™å¡ç‰‡èƒŒé¢æ·»åŠ data-indexå±æ€§ï¼Œç”¨äºå®šä½èƒŒæ™¯å›¾
                card.querySelector('.card-back').setAttribute('data-index', index);
                
                // ä¿®å¤å¡ç‰‡ç‚¹å‡»åè½¬bugï¼šä»…ç‚¹å‡»æ­£é¢éæŒ‰é’®åŒºåŸŸæ‰ç¿»è½¬
                card.querySelector('.card-front').addEventListener('click', function(e) {
                    if (!e.target.closest('.close-btn') && !e.target.closest('.claim-btn') && !e.target.closest('.view-claims-btn')) {
                        card.classList.add('flipped');
                    }
                });
                
                // é˜»æ­¢èƒŒé¢å†…å®¹ç‚¹å‡»è§¦å‘ç¿»è½¬
                card.querySelector('.card-back').addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                
                stockContainer.appendChild(card);
            });
        }

        // æ˜¾ç¤ºè®¤é¢†è¯¦æƒ…æ¨¡æ€æ¡†
        function showClaimDetails(index) {
            currentClaimDetailsIndex = index;
            const item = guziData[index];
            
            // æ›´æ–°æ¨¡æ€æ¡†æ ‡é¢˜
            document.getElementById('claimsModalTitle').textContent = `${item.category} è®¤é¢†è¯¦æƒ…`;
            
            // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
            const totalStock = item.stock + item.claimers.length; // æ€»åº“å­˜ = å‰©ä½™åº“å­˜ + å·²è®¤é¢†æ•°é‡
            const remainingStock = item.stock;
            const claimedCount = item.claimers.length;
            
            // ç»Ÿè®¡è®¤é¢†äººæ•°é‡
            const claimersMap = {};
            item.claimers.forEach(name => {
                claimersMap[name] = (claimersMap[name] || 0) + 1;
            });
            const claimersCount = Object.keys(claimersMap).length;
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('totalStock').textContent = totalStock;
            document.getElementById('remainingStock').textContent = remainingStock;
            document.getElementById('claimedCount').textContent = claimedCount;
            document.getElementById('claimersCount').textContent = claimersCount;
            
            // æ›´æ–°è®¤é¢†è®°å½•è¡¨æ ¼
            const claimsTableBody = document.getElementById('claimsTableBody');
            const noClaimsMessage = document.getElementById('noClaimsMessage');
            
            if (claimedCount > 0) {
                // æœ‰è®¤é¢†è®°å½•ï¼Œæ˜¾ç¤ºè¡¨æ ¼
                claimsTableBody.innerHTML = '';
                let totalAmount = 0;
                
                Object.entries(claimersMap).forEach(([name, count]) => {
                    const amount = count * item.price;
                    totalAmount += amount;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${name}</td>
                        <td>${count} ä¸ª</td>
                    `;
                    claimsTableBody.appendChild(row);
                });
                
                
                claimsTableBody.style.display = 'table-row-group';
                noClaimsMessage.style.display = 'none';
            } else {
                // æ— è®¤é¢†è®°å½•ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                claimsTableBody.style.display = 'none';
                noClaimsMessage.style.display = 'block';
            }
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('claimsModal').style.display = 'flex';
        }

        // å…³é—­è®¤é¢†è¯¦æƒ…æ¨¡æ€æ¡†
        function closeClaimsModal() {
            document.getElementById('claimsModal').style.display = 'none';
            currentClaimDetailsIndex = -1;
        }

        function flipStockCard(index) {
            const card = document.querySelector(`.stock-card[data-index="${index}"]`);
            card.classList.remove('flipped');
        }

        function submitClaim(index) {
            if (!isLoggedIn) {
                alert('è¯·å…ˆç™»å½•æ‰èƒ½è®¤é¢†è°·å­');
                showLoginModal();
                return;
            }
            
            const claimerName = document.getElementById(`claimer-name-${index}`).value.trim();
            const claimQuantity = parseInt(document.getElementById(`claim-quantity-${index}`).value);
            
            if (!claimerName) {
                alert('è¯·è¾“å…¥è®¤é¢†äººCNåç§°ï¼');
                return;
            }
            
            if (isNaN(claimQuantity) || claimQuantity < 1 || claimQuantity > guziData[index].stock) {
                alert(`è®¤é¢†æ•°é‡å¿…é¡»åœ¨1-${guziData[index].stock}ä¹‹é—´ï¼`);
                return;
            }
            
            if (confirm(`ç¡®è®¤ç”±ã€${claimerName}ã€‘è®¤é¢†ã€${guziData[index].category}ã€‘${claimQuantity}ä¸ªå—ï¼Ÿæ— ç‰¹æ®ŠåŸå› ä¸å…è®¸æ’¤æ’ï¼Œè¯·ç¡®è®¤è®¤é¢†è¯¥è°·å­çš„è¯ç‚¹å‡»ç¡®è®¤ï¼Œå¦åˆ™ç‚¹å‡»å–æ¶ˆ`)) {
                // æ·»åŠ è®¤é¢†è®°å½•
                for (let i = 0; i < claimQuantity; i++) {
                    guziData[index].claimers.push(claimerName);
                }
                // æ›´æ–°åº“å­˜
                guziData[index].stock -= claimQuantity;
                // ä¿å­˜åˆ°Gist
                saveDataToLocalStorage();
                // åˆ·æ–°é¡µé¢
                renderStockPage();
                renderSummaryPage();
                alert('è®¤é¢†æˆåŠŸï¼');
                flipStockCard(index);
            }
        }

        function searchStock() {
            currentStockSearch = document.getElementById('stockSearchInput').value.trim();
            renderStockPage();
        }

        function resetStockSearch() {
            document.getElementById('stockSearchInput').value = '';
            currentStockSearch = '';
            renderStockPage();
        }

        function filterStock(filterType) {
            currentStockFilter = filterType;
            // æ›´æ–°ç­›é€‰æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter${filterType === 'all' ? 'All' : (filterType === 'inStock' ? 'InStock' : 'OutOfStock')}Btn`).classList.add('active');
            renderStockPage();
        }

        // ==================== ç½‘æ ¼å¸ƒå±€å¯¼å‡ºä½™é‡å›¾åŠŸèƒ½ ====================
        function previewStockGrid() {
            const previewContainer = document.getElementById('previewContainer');
            const stockPreviewGrid = document.getElementById('stockPreviewGrid');
            const gridSize = currentGridSize;
            const [cols, rows] = gridSize.split('x').map(Number);
            const itemsPerPage = cols * rows;

            // ç­›é€‰éœ€è¦å±•ç¤ºçš„è°·å­æ•°æ®
            let filteredData = guziData.filter(item => {
                if (currentExportFilter === 'inStock' && item.stock <= 0) return false;
                if (currentExportFilter === 'outOfStock' && item.stock > 0) return false;
                if (currentExportSearch && !item.category.toLowerCase().includes(currentExportSearch.toLowerCase()) && 
                    !item.kunxu.toLowerCase().includes(currentExportSearch.toLowerCase())) {
                    return false;
                }
                return true;
            });

            // æ¸…ç©ºé¢„è§ˆå®¹å™¨
            stockPreviewGrid.innerHTML = '';
            previewedGridData = [];

            // è®¡ç®—æ€»é¡µæ•°å’Œæœ€åä¸€é¡µçš„å“ç±»æ•°
            const totalItems = filteredData.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const lastPageItems = totalItems % itemsPerPage || itemsPerPage; // å¦‚æœä½™æ•°ä¸º0ï¼Œæœ€åä¸€é¡µä¹Ÿæ˜¯æ»¡çš„
            
            // ç”Ÿæˆæç¤ºä¿¡æ¯
            let previewInfo = '';
            if (totalPages === 0) {
                previewInfo = 'æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å“ç±»';
            } else if (totalPages === 1) {
                previewInfo = `å…±${totalItems}ä¸ªå“ç±»ï¼Œç”Ÿæˆ1å¼ å›¾`;
            } else {
                if (lastPageItems === itemsPerPage) {
                    previewInfo = `å…±${totalItems}ä¸ªå“ç±»ã€‚å°†ä¼šç”Ÿæˆ${totalPages}å¼ å›¾ï¼Œæ¯å¼ åŒ…å«${itemsPerPage}ä¸ªå“ç±»`;
                } else {
                    previewInfo = `å…±${totalItems}ä¸ªå“ç±»ã€‚å°†ä¼šç”Ÿæˆ${totalPages}å¼ å›¾ï¼Œæ¯å¼ åŒ…å«${itemsPerPage}ä¸ªå“ç±»ï¼ˆæœ€åä¸€å¼ ${lastPageItems}ä¸ªï¼‰`;
                }
            }
            
            document.getElementById('previewInfo').innerText = previewInfo;

            // ç”Ÿæˆæ¯é¡µçš„ç½‘æ ¼
            for (let page = 0; page < totalPages; page++) {
                const pageData = filteredData.slice(page * itemsPerPage, (page + 1) * itemsPerPage);
                previewedGridData.push(pageData);

                const pageGrid = document.createElement('div');
                pageGrid.className = `stock-grid-preview grid-${gridSize}`;
                pageGrid.style.marginBottom = '20px';


                // ç”Ÿæˆå½“å‰é¡µçš„æ¯ä¸ªå¡ç‰‡ - ä½¿ç”¨åº“å­˜å¡ç‰‡è®¾è®¡
                pageData.forEach(item => {
                    const gridItem = document.createElement('div');
                    const isOutOfStock = item.stock <= 0;
                    gridItem.className = `export-card-front ${isOutOfStock ? 'out-of-stock' : ''}`;
                    
                    // è·å–è°·å­å›¾ç‰‡åœ°å€
                    const imgSrc = item.imgSrc || defaultImgUrl;
                    
                    // åˆ›å»ºå¡ç‰‡å†…å®¹ - æ²¿ç”¨åº“å­˜å¡ç‰‡è®¾è®¡ä½†è°ƒæ•´å¸ƒå±€
                    gridItem.innerHTML = `
                        ${item.kunxu !== 'ä¸æ†' ? `<div class="kunxu-tag">${item.kunxu}</div>` : ''}
                        <div style="position: relative; display: inline-block;">
                            <img src="${imgSrc}" alt="${item.category}">
                            <div class="stock-num-overlay">${item.stock}</div>
                        </div>
                        <div class="category-name">${item.category}</div>
                        <div class="price-info">å•ä»·ï¼šÂ¥${item.price.toFixed(2)}</div>
                    `;
                    
                    pageGrid.appendChild(gridItem);
                });

                stockPreviewGrid.appendChild(pageGrid);
            }

            // æ˜¾ç¤ºé¢„è§ˆå®¹å™¨ï¼Œå¯ç”¨æ‰“å°æŒ‰é’®
            previewContainer.classList.add('visible');
            document.querySelector('.print-btn').disabled = false;
        }

        // ==================== æ‰“å°åŠŸèƒ½ ====================
        function printPreview() {
            const previewContainer = document.getElementById('previewContainer');
            const stockPreviewGrid = document.getElementById('stockPreviewGrid');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰é¢„è§ˆå†…å®¹
            if (!previewContainer || !previewContainer.classList.contains('visible') || stockPreviewGrid.children.length === 0) {
                alert('è¯·å…ˆç¡®è®¤è¦æ‰“å°çš„è§„æ ¼ï¼');
                return;
            }
            
            // è·å–é¢„è§ˆæ ‡é¢˜ä¿¡æ¯
            const previewInfo = document.getElementById('previewInfo').textContent;
            
            // åˆ›å»ºæ‰“å°ä¸“ç”¨çš„HTML
            let printHTML = `
                <!DOCTYPE html>
                <html lang="zh-CN">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>åº“å­˜ä½™é‡å›¾ - æ‰“å°é¢„è§ˆ</title>
                    <style>
                        body {
                            margin: 0;
                            padding: 20px;
                            font-family: Arial, sans-serif;
                            background: white;
                        }
                        
                        .print-header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #333;
                            padding-bottom: 15px;
                        }
                        
                        .print-header h1 {
                            font-size: 28px;
                            color: #2c3e50;
                            margin: 0 0 10px 0;
                        }
                        
                        .print-header .info {
                            font-size: 16px;
                            color: #666;
                        }
                        
                        .print-grid-container {
                            display: flex;
                            flex-direction: column;
                            gap: 40px;
                        }
                        
                        .print-page {
                            page-break-after: always;
                            padding-bottom: 40px;
                        }
                        
                        .print-page:last-child {
                            page-break-after: auto;
                        }
                        
                        .print-grid {
                            display: grid;
                            gap: 20px;
                            justify-content: center;
                            margin: 0 auto;
                        }
                        
                        .grid-3x3 {
                            grid-template-columns: repeat(3, 280px);
                        }
                        
                        .grid-4x4 {
                            grid-template-columns: repeat(4, 240px);
                        }
                        
                        .grid-5x5 {
                            grid-template-columns: repeat(5, 220px);
                        }
                        
                        .print-card {
                            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                            border: 2px solid #333;
                            border-radius: 12px;
                            padding: 20px;
                            text-align: center;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                            height: 400px;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            position: relative;
                        }
                        
                        .print-card::before {
                            content: '';
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 4px;
                            background: linear-gradient(90deg, #007bff, #28a745);
                        }
                        
                        .print-card.out-of-stock::before {
                            background: linear-gradient(90deg, #dc3545, #ffc107);
                        }
                        
                        .print-card img {
                            width: 180px;
                            height: 180px;
                            object-fit: cover;
                            border-radius: 8px;
                            margin: 15px auto;
                            border: 2px solid #fff;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                            position: relative;
                        }
                        
                        .print-card .stock-num-overlay {
                            position: absolute;
                            bottom: 5px;
                            right: 5px;
                            background-color: rgba(255, 255, 255, 0.85);
                            border-radius: 50%;
                            width: 45px;
                            height: 45px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 22px;
                            font-weight: 800;
                            color: #28a745;
                            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                            border: 2px solid #fff;
                        }
                        
                        .print-card.out-of-stock .stock-num-overlay {
                            color: #dc3545;
                            text-decoration: line-through;
                        }
                        
                        .print-card .category-name {
                            font-weight: 700;
                            font-size: 16px;
                            color: #2c3e50;
                            margin-bottom: 8px;
                            white-space: nowrap;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            max-width: 90%;
                        }
                        
                        .print-card .price-info {
                            margin-top: 10px;
                            font-size: 22px;
                            color: #007bff;
                            font-weight: 700;
                        }
                        
                        .print-card .kunxu-tag {
                            position: absolute;
                            top: 10px;
                            right: 10px;
                            font-size: 12px;
                            padding: 2px 8px;
                            background-color: #007bff;
                            color: white;
                            border-radius: 12px;
                        }
                        
                        .print-footer {
                            text-align: center;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px solid #ddd;
                            color: #666;
                            font-size: 14px;
                        }
                        
                        @media print {
                            @page {
                                size: A4 portrait;
                                margin: 15mm;
                            }
                            
                            body {
                                padding: 0;
                            }
                            
                            .print-page {
                                margin-bottom: 40px;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-header">
                        <h1>åº“å­˜ä½™é‡å›¾</h1>
                        <div class="info">${previewInfo} - æ‰“å°æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}</div>
                    </div>
                    <div class="print-grid-container">
            `;
            
            // æ·»åŠ æ¯ä¸ªç½‘æ ¼é¡µé¢
            const gridPages = stockPreviewGrid.querySelectorAll('.stock-grid-preview');
            gridPages.forEach((page, pageIndex) => {
                printHTML += `<div class="print-page">`;
                
                // è·å–ç½‘æ ¼å°ºå¯¸ç±»
                const gridClass = Array.from(page.classList).find(cls => cls.startsWith('grid-'));
                const printGridClass = gridClass || 'grid-3x3';
                
                printHTML += `<div class="print-grid ${printGridClass}">`;
                
                // å¤åˆ¶æ¯ä¸ªç½‘æ ¼é¡¹ç›®
                const gridItems = page.querySelectorAll('.export-card-front');
                gridItems.forEach(gridItem => {
                    // è·å–å›¾ç‰‡URL
                    const imgEl = gridItem.querySelector('img');
                    const imgSrc = imgEl ? imgEl.src : '';
                    
                    // è·å–æ–‡æœ¬å†…å®¹
                    const kunxuEl = gridItem.querySelector('.kunxu-tag');
                    const nameEl = gridItem.querySelector('.category-name');
                    const stockNumEl = gridItem.querySelector('.stock-num-overlay');
                    const priceEl = gridItem.querySelector('.price-info');
                    
                    const kunxu = kunxuEl ? kunxuEl.textContent : '';
                    const name = nameEl ? nameEl.textContent : '';
                    const stockNum = stockNumEl ? stockNumEl.textContent : '';
                    const price = priceEl ? priceEl.textContent : '';
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸ºå·²å”®ç½„
                    const isOutOfStock = gridItem.classList.contains('out-of-stock');
                    
                    printHTML += `
                        <div class="print-card ${isOutOfStock ? 'out-of-stock' : ''}">
                            ${kunxu ? `<div class="kunxu-tag">${kunxu}</div>` : ''}
                            ${imgSrc ? `<img src="${imgSrc}" alt="${name}"><div class="stock-num-overlay">${stockNum}</div>` : ''}
                            <div class="category-name">${name}</div>
                            <div class="price-info">${price}</div>
                        </div>
                    `;
                });
                
                printHTML += `</div></div>`;
            });
            
            printHTML += `
                    </div>
                    <div class="print-footer">
                        æ™ºèƒ½æ’è°·ç®¡ç†ç³»ç»Ÿ - ä½™é‡å›¾æ‰“å°ç‰ˆ
                    </div>
                </body>
                </html>
            `;
            
            // æ‰“å¼€æ–°çª—å£å¹¶æ‰“å°
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            // ç­‰å¾…å†…å®¹åŠ è½½å®Œæˆåæ‰“å°
            printWindow.onload = function() {
                setTimeout(() => {
                    printWindow.print();
                }, 500);
            };
        }

        // ==================== ç»“ç®—ç»Ÿè®¡é¡µé¢åŠŸèƒ½ ====================
        function renderSummaryPage() {
            if (!currentSearchCN) return;
            
            const summaryContainer = document.getElementById('summary-container');
            summaryContainer.innerHTML = '';
            
            // ç¬¬ä¸€æ­¥ï¼šæ”¶é›†æ‰€æœ‰åŒ…å«æœç´¢å…³é”®è¯çš„CNåç§°ï¼ˆå»é‡ï¼‰
            const searchKeyword = currentSearchCN.toLowerCase();
            const matchedCNs = new Set();
            
            guziData.forEach(item => {
                item.claimers.forEach(name => {
                    if (name.toLowerCase().includes(searchKeyword)) {
                        matchedCNs.add(name);
                    }
                });
            });
            
            // æ²¡æœ‰åŒ¹é…çš„CN
            if (matchedCNs.size === 0) {
                summaryContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: #666; background: #f8f9fa; border-radius: 8px;">æœªæŸ¥è¯¢åˆ°åŒ…å«ã€' + currentSearchCN + 'ã€‘çš„è®¤é¢†è®°å½•</div>';
                return;
            }
            
            // ç¬¬äºŒæ­¥ï¼šä¸ºæ¯ä¸ªåŒ¹é…çš„CNå•ç‹¬ç”Ÿæˆç»Ÿè®¡å¡ç‰‡
            Array.from(matchedCNs).forEach(cn => {
                const userClaims = [];
                let totalCost = 0;
                let totalQuantity = 0;
                
                // ç»Ÿè®¡å½“å‰CNçš„æ‰€æœ‰è®¤é¢†è®°å½•
                guziData.forEach(item => {
                    const claimCount = item.claimers.filter(name => name === cn).length;
                    if (claimCount > 0) {
                        const cost = claimCount * item.price;
                        totalCost += cost;
                        totalQuantity += claimCount;
                        userClaims.push({
                            category: item.category,
                            price: item.price,
                            quantity: claimCount,
                            cost: cost,
                            imgSrc: item.imgSrc || defaultImgUrl
                        });
                    }
                });
                
                // ç”Ÿæˆå½“å‰CNçš„ç»Ÿè®¡å¡ç‰‡
                const summaryCard = document.createElement('div');
                summaryCard.className = 'summary-card';
                summaryCard.innerHTML = `
                    <h3>${cn} çš„æ’è°·ç»Ÿè®¡</h3>
                    <div class="summary-header">
                        <div class="img-col">å›¾ç‰‡</div>
                        <div class="category-col">å“ç±»ï¼ˆå•ä»·ï¼‰</div>
                        <div class="quantity-col">æ•°é‡</div>
                        <div class="cost-col">é‡‘é¢</div>
                    </div>
                    ${userClaims.map(item => `
                        <div class="summary-item">
                            <div class="img-col">
                                <img src="${item.imgSrc}" alt="${item.category}" onclick="openImgModal('${item.imgSrc}')">
                            </div>
                            <div class="category-col">${item.category}ï¼ˆÂ¥${item.price.toFixed(2)}/ä¸ªï¼‰</div>
                            <div class="quantity-col">${item.quantity} ä¸ª</div>
                            <div class="cost-col">Â¥${item.cost.toFixed(2)}</div>
                        </div>
                    `).join('')}
                    <div class="summary-total">
                        <div class="total-label">æ€»è®¡</div>
                        <div class="total-values">
                            <div>æ€»è°·å­ä¸ªæ•°ï¼š${totalQuantity} ä¸ª</div>
                            <div>æ€»é‡‘é¢ï¼šÂ¥${totalCost.toFixed(2)}</div>
                        </div>
                    </div>
                `;
                
                // æ·»åŠ å¯¼å‡ºæŒ‰é’®ï¼ˆæ¯ä¸ªCNç‹¬ç«‹å¯¼å‡ºï¼‰
                const exportBtn = document.createElement('button');
                exportBtn.className = 'btn export-btn';
                exportBtn.innerText = `å¯¼å‡º${cn}çš„ç»“ç®—å•`;
                exportBtn.style.marginTop = '15px';
                exportBtn.onclick = () => exportUserSummary(cn, userClaims, totalCost, totalQuantity);
                summaryCard.appendChild(exportBtn);
                
                summaryContainer.appendChild(summaryCard);
            });
        }

        // å›¾ç‰‡æ”¾å¤§å¼¹çª—åŠŸèƒ½
        function openImgModal(imgUrl) {
            const modal = document.getElementById('imgModal');
            const modalImg = document.getElementById('modalImg');
            modal.style.display = "flex";
            modalImg.src = imgUrl;
        }

        function closeImgModal() {
            document.getElementById('imgModal').style.display = "none";
        }

        // ç‚¹å‡»å¼¹çª—å¤–åŒºåŸŸå…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('imgModal');
            if (event.target === modal) {
                modal.style.display = "none";
            }
        }

        function searchCN() {
            currentSearchCN = document.getElementById('cnSearchInput').value.trim();
            if (!currentSearchCN) {
                alert('è¯·è¾“å…¥è¦æŸ¥è¯¢çš„CNåç§°ï¼');
                return;
            }
            renderSummaryPage();
        }

        function resetSearch() {
            document.getElementById('cnSearchInput').value = '';
            currentSearchCN = '';
            document.getElementById('summary-container').innerHTML = '';
        }

        function exportUserSummary(cn, claims, totalCost, totalQuantity) {
            // å¯¼å‡ºæ—¶æ’é™¤å›¾ç‰‡åˆ—
            const wsData = claims.map(item => [
                item.category,
                item.price.toFixed(2),
                item.quantity,
                item.cost.toFixed(2)
            ]);
            wsData.unshift(['å“ç±»', 'å•ä»·', 'è®¤é¢†æ•°é‡', 'é‡‘é¢']);
            wsData.push(['', '', 'æ€»è®¡', '']);
            wsData.push(['', '', `æ€»è°·å­ä¸ªæ•°ï¼š${totalQuantity} ä¸ª`, `æ€»é‡‘é¢ï¼šÂ¥${totalCost.toFixed(2)}`]);
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, `${cn}ç»“ç®—å•`);
            XLSX.writeFile(wb, `${cn}_æ’è°·ç»“ç®—å•_${new Date().toLocaleDateString()}.xlsx`);
        }
    </script>
</body>
</html>